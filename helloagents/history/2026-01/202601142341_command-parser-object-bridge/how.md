# 技术设计: 提示词对象输出的下游兼容与测试更新

## 技术方案
### 核心技术
- 现有三段式解析保持不变
- 在 parse_command_output 中新增对象数组预处理

### 实现要点
- JSON 解析后支持两种输入：
  - `array<string>`：保持现有逻辑
  - `array<object>`：将对象转换为 `ACTION-SCOPE-TARGET`
- 预处理规则：
  - 默认值：a=UNKNOWN, s="*", n="*", t="Unknown", q="one"
  - c 仅在明确整数且 >0 时输出
  - 清理分隔符：a/s/n 中移除 `-` 与 `#`，避免破坏三段式
  - 非法条目（非 dict/str）记错误并忽略
- 生成的字符串继续走 _parse_command_string，复用类型/量词/数量校验逻辑

## 架构设计
无架构变化，解析入口增加一层适配。

## 架构决策 ADR
### ADR-001: 预处理桥接对象输出
**上下文:** 提示词改为对象输出，但解析器基于三段式字符串  
**决策:** 在 parse_command_output 中将对象数组转换为旧字符串再解析  
**理由:** 兼容性最好、改动范围小、复用现有校验与降级逻辑  
**替代方案:** 重写解析器直接解析对象  
**影响:** 支持新旧输出并存，解析入口复杂度略增

## API设计
parse_command_output 的输入仍为字符串，但可接受对象数组的 JSON 文本。

## 数据模型
无新增数据模型。

## 安全与性能
- 预处理过程中清理分隔符，避免注入导致解析歧义
- 不增加外部依赖

## 测试与部署
- 更新单元测试覆盖对象输出
- 更新集成测试说明与协议文档
