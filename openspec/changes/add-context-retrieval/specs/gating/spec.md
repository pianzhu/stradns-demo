# 功能：置信度门控

## 概述

置信度门控机制，当候选设备分数接近时触发最小澄清，避免盲选。

## 新增需求

### 需求：最小澄清触发

当 top1 和 top2 候选的分数差小于阈值时，系统必须返回澄清请求而非直接选择。

#### 场景：分差不足触发澄清

- 给定：候选列表包含 lamp-1（score=0.80）和 lamp-2（score=0.78）
- 且：epsilon 阈值为 0.05
- 当：执行门控
- 则：应返回 ClarificationRequest
- 且：选项数量应为 2

#### 场景：分差足够直接选择

- 给定：候选列表包含 lamp-1（score=0.90）和 lamp-2（score=0.60）
- 且：epsilon 阈值为 0.05
- 当：执行门控
- 则：不应返回 ClarificationRequest
- 且：selected 应包含 lamp-1

### 需求：空结果处理

当没有召回候选时，系统必须返回友好的澄清消息。

#### 场景：无候选时返回澄清

- 给定：候选列表为空
- 当：执行门控
- 则：应返回 ClarificationRequest
- 且：question 应提示用户换个说法

### 需求：澄清选项生成

澄清请求必须包含可读的设备标签。

#### 场景：澄清选项使用友好标签

- 给定：候选设备 lamp-1 的标签为"客厅/台灯"
- 当：生成澄清请求
- 则：选项的 label 应为"客厅/台灯"

## 相关功能

- [context-retrieval](../context-retrieval/spec.md)
